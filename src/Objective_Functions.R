# Define some objective functions for runoff routing Nash-Sutcliffe efficiency

#Several summary statistics are used to calibrate and quantify the routing model 
#performance compared to observed discharge at NWIS gages. Statistics include:
# 1.  Nash-Sutcliffe Efficiency (NSE), 
# 2.  Ratio of the Root Mean Square Error to the Standard Deviation (RSR),
# 3.  Percent Bias (PBIAS) (Moriasi, et al., 2007), 
# 4.  The Coefficient of Determination (R2)(Legates and McCabe, 1999). 
# 5.  Sum of squares (SSE)
# 6.  Root-mean squared error (RMSE)
# 7.  Mean absolute error (MAE)

#These statistics are summarized at:
#  https://www.hec.usace.army.mil/confluence/hmsdocs/hmstrm/calibration/calibration-summary-statistics

NSE <- function(sim, obs) {
  1 - sum((sim - obs)^2, na.rm = TRUE) / 
    sum((obs - mean(obs, na.rm = TRUE))^2, na.rm = TRUE)
}

RSR <- function(sim,obs) {
  abs(sqrt(sum((obs-sim)^2, na.rm = TRUE))) / abs(sqrt(sum((obs-mean(obs))^2, na.rm = TRUE)))
}

PBIAS <- function(sim,obs) {
  abs((sum(obs-sim, na.rm = TRUE) * 100) / sum(obs, na.rm = TRUE))  
} 

# coefficient of determination (R^2)
COD <- function (sim,obs) {
  abs(sum((obs-mean(obs, na.rm = TRUE)) * (sim - mean(sim, na.rm = TRUE)), na.rm = TRUE) / (
    sqrt(sum((obs-mean(obs, na.rm = TRUE))^2, na.rm = TRUE)) * sqrt(sum((sim-mean(sim, na.rm = TRUE))^2, na.rm = TRUE)))) ^2
}

SSE <- function(sim, obs) {
  sum((sim - obs)^2,
      na.rm=TRUE)
}

# RMSE
RMSE <- function(sim, obs) {
  squared_diff <- (sim - obs)^2
  return(sqrt(mean(squared_diff, na.rm = TRUE)))
}

MAE <- function(sim,obs) {
  mean(abs(sim - obs), na.rm = TRUE)
}