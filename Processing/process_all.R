#' Function to process and save data from all data retrieval functions
#' 
#' This function executes all data retrieval functions for specified park(s) and saves them within
#' a single park code folder within user-specified 'path' directory
#' 
#' @param park The 4 digit national park code(s) for parks of interest
#' @param path The file path to save all files to. Path MUST end with '/'
#' @param dist Specify the distance (in decimal degrees) to buffer around park boundary
#' 
#' @return Writes all data outputs to a folder with the park code within 'path'. 
processData <- function(park, path, dist = NULL){
  
  # SET UP -----------------------------------------------------------
  
  #source set up script
  source("setup.R")
  

  # create a directory for each park within 'path/'
  map(park, ~ dir.create(paste0(path, .x)))
  
  
  # Define AOI (merged area of park buffer, watersheds and aquifers overlapping park boundary)
  
  park_boundary <-
    getParkBoundary(park = park, save = TRUE, path = path)
  
  # buffered boundary
  park_buffer <- st_buffer(park_boundary, dist = dist)
  
  
  #watersheds intersecting boundary
  watersheds <-
    getWatersheds(aoi = park_boundary, save = TRUE, path = path)
  
  
  
  
  #aquifers intersecting boundary
  aquifers <-
    getAquifers(aoi = park_buffer, save = FALSE, path = path)
  
  
  # merge all to create aoi for data retreival functions
  aoi <- bind_rows(park_buffer, watersheds) %>%
    summarise()
  
  
  
  
  # NPS-IRMA DataStore -----------------------------------------------
  
  
  
  # NPS-IRMA Visitation ----------------------------------------------
  
  
  
  # NPS buildings and parking lots -----------------------------------
  
  
  
  # NWIS -------------------------------------------------------------
  
  
  
  # Aquarius ---------------------------------------------------------
  
  
  
  # National Water Quality Portal (WQP) ------------------------------
  
  
  
  # NOAA Weather Stations -------------------------------------------
  
  
  
  # USDA SCAN/SNOTEL Weather Stations -------------------------------
  
  
  
  # Gridded Water Balance Model Dataset -----------------------------
  
  
  
  # USGS Ground-Water Recharge Raster ------------------------------
  
  
  
  
  # National Land Cover Database (NLCD) ----------------------------
  
  
  
  
  # National Inventory of Dams ------------------------------------
  
  
  
  
  # Water withdrawls ---------------------------------------------
  
  
  
  
  # state-specific functions ------------------------------------
  
  if (park$state == "CA") {
    purrr::map(list.files(
      path = "src/CA",
      pattern = "*.R",
      full.names = TRUE
    ),
    source)
    
    # run functions
    
  }
  
  # end by saving all objects to .RData file, with parks included in objects in file name
  save("objects to save", file = paste0(path, "all_objects_", paste(park, collapse = "_"), ".RData"))
  
  
}







